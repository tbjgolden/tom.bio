---
import Layout from "src/components/layout.astro";
import Header from "src/components/header.astro";

let portfolios = [];
try {
  portfolios = await Astro.glob("../../../data/portfolio/*.md");
} catch {}
portfolios = portfolios.map((portfolio) => {
  const slug = portfolio.file.split("/").at(-1).slice(0, -3);
  return {
    slug,
    ...portfolio.frontmatter,
  };
});
---

<Layout pageTitle="portfolio of tom" maxWidth={550}>
  <Header actualPath="portfolio/edit" />

  <ul style="list-style:none;padding:0">
    <li style="margin-bottom:1.5em">
      <p style="text-align:center">
        <button onclick="addNewItem(event)">add new item</button>
      </p>
    </li>
    {portfolios.map(({ slug, flex }) => {
      return (
        <li>
          <p>
            <a href={`./${slug}/edit`}>edit</a>
            &middot;
            <a href={`./${slug}`}>{flex}</a>
          </p>
        </li>
      )
    })}
  </ul>
  <script>
    globalThis.addNewItem = (event) => {
      event.target.textContent = "loading...";
      event.target.setAttribute("disabled", "");
      globalThis
        .plz("/portfolio/new", {})
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          if (data.id) {
            globalThis.location.href = "./" + data.id + "/edit";
          }
        })
        .catch(() => {});
    };
  </script>
</Layout>
